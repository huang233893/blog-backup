---
title: 路由选择原理
summary: >-
  酥米小机器人来啦，这篇文章主要讲解路由选择原理包括路由信息来源如直连路由需接口配置IP且物理数据链路层UP静态路由手工配置或通过动态路由协议如RIP
  OSPF IS-IS EIGRP BGP学习管理距离AD值用于判断路由优先级有类路由查找基于主类网络逐级匹配无类路由查找则通过最长匹配原则逐位bit by
  bit比较路由表条目最长匹配原则优先选择最具体路由如主机地址子网汇总路由主网号超网CIDR等若无匹配则使用缺省地址递归查询用于处理下一跳非直连路由的情况协议分类上RIPv1
  IGRP为有类路由选择协议OSPF EIGRP ISIS
  BGP等为无类路由选择协议区别在于更新消息是否包含网络掩码浮动静态路由通过修改AD实现路由冗余静态路由汇总则通过改变子网掩码简化路由表配置命令如Ip
  route 192.168.10.0 255.255.255.0 192.168.1.1指向下一跳或Ip route 192.168.10.0
  255.255.255.0 fa 0/0指向出接口需注意出接口为广播型时可能造成ARP负担路由表查找需比较
categories:
  - 思科
tags:
  - 网络
  - CCNP
cover: >-
  https://cdn.nlark.com/yuque/0/2024/png/44908083/1729556630961-3d015d9f-3ae5-4c13-80fd-44414035a0ed.png
date: 2024-11-21 09:01:46
---

<meta name="referrer" content="no-referrer" />

## 路由选择原理
![](https://cdn.nlark.com/yuque/0/2024/png/44908083/1729556630961-3d015d9f-3ae5-4c13-80fd-44414035a0ed.png)

![](https://cdn.nlark.com/yuque/0/2024/png/44908083/1729556639379-05e1075f-512e-4609-9792-e21fcde11d20.png)

+ 路由信息来源
+ 管理距离（AD值）
+ 有类及无类路由查找
+ 最长匹配原则
+ 递归查询

## 路由信息的来源
+ 直连路由
    - 接口配置IP，该接口的物理层和数据链路层UP
    - 通过接口感知到的直连网络
+ 静态路由
    - 使用静态路由命令手工配置的路由
+ 动态路由
    - 通过动态路由协议学习
    - 常见路由协议：RIP、OSPF、IS-IS、EIGRP、BGP

## 管理距离（AD值）
![](https://cdn.nlark.com/yuque/0/2024/png/44908083/1729557010043-46b3011e-6b27-48c8-9f06-c8b053d29574.png)

## 有类及无类路由查找
+ **无类路由查找**：路由器不会注意目的地址的类别，它会在目的地址和所有己知的路由之间逐位(bit by bit)执行最长匹配
+ **有类路由查找**（no ip classless）：路由器收到一个数据包时，先查找目的地址所属主类网络，如果路由表中存在该主类网络的路由，则继续找子网，如果没有子网路由则丢弃数据包（即使本地有默认路由，也同样丢弃），如果有则正常转发;而如果本地路由表里没有该目的地址所属主类网络的路由，则看是否有默认路由，如果有，则转发，如果没有，则丢弃。

## 最长匹配原则
+ 主机地址（主机路径）
+ 子网
+ 一组子网（汇总路由）
+ 主网号
+ 超网（CIDR）
+ 缺省地址

![](https://cdn.nlark.com/yuque/0/2024/png/44908083/1729557446146-ebde076d-6d67-4744-b602-f3af3c202b25.png)

![](https://cdn.nlark.com/yuque/0/2024/png/44908083/1729558543372-6f0ce184-42bb-46e0-b9de-9f3f89514936.png)

## 路由表的查找
+ 不同的前缀，在路由表中属于不同的路由
+ 相同的前缀，先比AD，后比metric
+ 匹配，转发；不匹配，丢弃
+ 路由器的行为是逐跳的，到目标网络的沿路径每个路由器都必须有关于目标的路由
+ 数据是双向的，考虑流量的时候，要关注流量的往返

## 路由表的递归查询
![](https://cdn.nlark.com/yuque/0/2024/png/44908083/1729558770399-0145f42d-3b34-47d4-8415-b50b98eeaf42.png)

## 协议分类
+ 有类路由选择协议：RIPv1、IGRP
    - ![](https://cdn.nlark.com/yuque/0/2024/png/44908083/1729565436293-0236dbc1-1d8c-4bd1-a0c3-df14ecd55870.png)
+ 无类路由选择协议：OSPF、EIGRP、ISIS、BGP等
+ 根本区别在于：更新消息中是否含有网络掩码

## 浮动的静态路由
![](https://cdn.nlark.com/yuque/0/2024/png/44908083/1729566091093-7800b4ae-dc55-4da4-b7c4-0c96f54807fc.png)

+ 通过修改缺省的管理具体实现路由冗余

### 静态路由汇总
+ 改变子网掩码，通过汇总路由匹配明细，从而简化路由表

![](https://cdn.nlark.com/yuque/0/2024/png/44908083/1729578966077-6f787972-1326-45fc-b640-0408a427dc5e.png)

![](https://cdn.nlark.com/yuque/0/2024/png/44908083/1729580677499-e739e627-2e8e-4eb7-9a22-19a2caf8e673.png)

## 基础配置
![](https://cdn.nlark.com/yuque/0/2024/png/44908083/1729565692870-f2f68474-85ac-4f44-b6ff-8ff47e689483.png)

`Ip route 192.168.10.0 255.255.255.0 192.168.1.1`

使用指向下一跳的静态路由

`Ip route 192.168.10.0 255.255.255.0 fa 0/0`

使用指向出接口的静态路由该条目将作为直连网络输入到路由表中如果出接口为广播型接口，可能会给接口下的节点造成额外的负担(ARP)

```plain
Router# show ip route
Gateway of last resort is not set 
9.0.0.0/2 4 is subnetted,2 subnets
C		9.9.12.0 is directly connected, FastEthernet0/0
S		9.9.23.0 is directly connected, FastEthernet0/0
```